<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FCFS CPU Scheduling — Simulation</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <main>
    <h1>FCFS CPU Scheduling Simulator</h1>
    <p>
      This tool visualizes the <strong>First Come First Serve (FCFS)</strong> CPU Scheduling algorithm.
      Add your processes below and click <strong>Simulate</strong> to view the Gantt chart animation.
    </p>

    <hr />

    <!-- Process Input Section -->
    <section>
      <h2>Process Table</h2>
      <table id="process-table">
        <thead>
          <tr>
            <th>Process ID</th>
            <th>Arrival Time</th>
            <th>Burst Time</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="process-body">
          <tr>
            <td>P1</td>
            <td><input type="number" min="0" value="0" class="arrival" /></td>
            <td><input type="number" min="1" value="5" class="burst" /></td>
            <td><button onclick="removeRow(this)">Delete</button></td>
          </tr>
        </tbody>
      </table>

      <button id="add-process-btn">+ Add Process</button>
    </section>

    <hr />

    <!-- Controls & Statistics -->
    <section id="control-stats-section">
      <div id="controls">
        <button id="simulate-btn">Simulate FCFS</button>
        <button id="reset-btn">Reset</button>
      </div>

      <div id="statistics">
        <h3>Statistics</h3>
        <p><strong>Average Waiting Time:</strong> <span id="avg-wt">-</span></p>
        <p><strong>Average Turnaround Time:</strong> <span id="avg-tat">-</span></p>
      </div>
    </section>

    <hr />

    <!-- Animation Canvas -->
    <section>
      <h2>Gantt Chart</h2>
      <canvas id="scheduler-canvas" width="900" height="250"></canvas>
    </section>

    <!-- Ready Queue Display -->
    <section>
      <h3>Ready Queue (Execution Order)</h3>
      <div id="ready-queue-display">No processes yet.</div>
    </section>
  </main>

  <!-- Scripts -->
  <script src="algorithm.js"></script>
  <script src="animation.js"></script>

  <script>
    // Handle adding/removing processes dynamically
    const processBody = document.getElementById("process-body");
    let processCount = 1;

    document.getElementById("add-process-btn").addEventListener("click", () => {
      processCount++;
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>P${processCount}</td>
        <td><input type="number" min="0" value="0" class="arrival" /></td>
        <td><input type="number" min="1" value="5" class="burst" /></td>
        <td><button onclick="removeRow(this)">Delete</button></td>
      `;
      processBody.appendChild(row);
    });

    function removeRow(btn) {
      btn.parentElement.parentElement.remove();
    }

    document.getElementById("reset-btn").addEventListener("click", () => {
      processBody.innerHTML = `
        <tr>
          <td>P1</td>
          <td><input type="number" min="0" value="0" class="arrival" /></td>
          <td><input type="number" min="1" value="5" class="burst" /></td>
          <td><button onclick="removeRow(this)">Delete</button></td>
        </tr>
      `;
      document.getElementById("avg-wt").textContent = "-";
      document.getElementById("avg-tat").textContent = "-";
      document.getElementById("ready-queue-display").textContent = "No processes yet.";
      const ctx = document.getElementById("scheduler-canvas").getContext("2d");
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    });

    // Simulation trigger
    document.getElementById("simulate-btn").addEventListener("click", () => {
      const processes = [];
      document.querySelectorAll("#process-body tr").forEach((row, index) => {
        const arrival = parseInt(row.querySelector(".arrival").value);
        const burst = parseInt(row.querySelector(".burst").value);
        processes.push({
          id: `P${index + 1}`,
          arrivalTime: arrival,
          burstTime: burst
        });
      });

      const result = fcfsScheduling(processes);
      document.getElementById("avg-wt").textContent = result.avgWT.toFixed(2);
      document.getElementById("avg-tat").textContent = result.avgTAT.toFixed(2);

      document.getElementById("ready-queue-display").textContent =
        result.executionTrace.map(p => p.name).join(" → ");

      runFCFSAnimation(result.executionTrace);
    });
  </script>
</body>
</html>
